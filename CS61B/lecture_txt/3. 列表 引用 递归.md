# 3. 引用、递归与列表

---

### 列表

您无疑曾使用过列表数据结构。例如在Python中：

```python
L = [3, 5, 6]
L.append(7)
```

虽然Java内置了List类型，但我们将暂时避免使用。本章将从头构建自定义列表，并在此过程中学习Java的关键特性。

---

### 海象之谜

我们通过探究深奥的"海象之谜"开启探索之旅。请预测以下代码的运行结果（若熟悉Python，Java表现与之相同）：

```java
Walrus a = new Walrus(1000, 8.3);
Walrus b;
b = a;
b.weight = 5;
System.out.println(a);
System.out.println(b);
```

接着预测以下代码的结果：

```java
int x = 5;
int y;
y = x;
x = 2;
System.out.println("x is: " + x);
System.out.println("y is: " + y);
```

答案可在此[可视化工具](http://cscircles.cemc.uwaterloo.ca/java_visualize/)中验证。理解此谜题对数据结构效率与代码安全性至关重要。

---

### 比特

计算机所有信息以二进制形式存储：
- 72 → 01001000
- 205.75 → 01000011 01001101 11000000 00000000
- 'H' → 01001000（同72）
- true → 00000001

类型系统决定比特解释方式：

```java
char c = 'H';
int x = c;
System.out.println(c); // H
System.out.println(x); // 72
```

Java的8种基本类型：byte、short、int、long、float、double、boolean、char。

---

### 变量声明（简化模型）

声明变量时，Java分配连续内存块：
- `int x; double y;` 分配32位与64位空间
- 内存地址对程序员透明（不同于C语言）
- 未初始化变量禁止使用

赋值操作填充内存块：

```java
x = -1431195969;
y = 567213.112;
```

简化的盒子表示法更易理解：

![](x_and_y_simplified_box_notation.png)

---

### 等号黄金法则（GRoE）

赋值本质是比特复制：

```java
int x = 5;
int y;
y = x; // 复制x的比特到y
x = 2; // 仅修改x的比特
```

此法则适用于所有Java赋值操作，包括对象引用。

---

### 引用类型

非基本类型均为引用类型：
- 对象实例化分配实例变量空间
- 引用变量存储64位内存地址

```java
Walrus someWalrus = new Walrus(1000, 8.3);
```

引用表示法：
- null → 空指针
- 非空 → 指向对象的箭头

![](someWalrus_simplified_bit_notation.png)

解析海象之谜：

```java
Walrus a = new Walrus(1000, 8.3);
Walrus b = a; // 复制引用地址
```

![](mystery_of_the_walrus_resolved_step3.png)

---

### 参数传递

Java始终按值传递（复制比特）：

```java
public static void main(String[] args) {
    double x = 5.5;
    double y = 10.5;
    double avg = average(x, y); // 复制x,y的比特
}
```

引用类型参数传递示意图：

![](average_a_b.png)

练习解析：

```java
doStuff(walrus, x); 
// 复制walrus引用和x值
// 修改W.weight影响原对象
// x的修改不影响main中的x
```

---

### 数组实例化

数组变量存储引用：

```java
int[] x = new int[]{0, 1, 2, 95, 4};
int[] y = new int[]{0, 1, 2, 95, 4};
System.out.println(x == y); // false（比较地址）
System.out.println(Arrays.equals(x, y)); // true（比较内容）
```

---

### IntList实现

基础链表实现：

```java
public class IntList {
    public int first;
    public IntList rest;
    
    public IntList(int f, IntList r) {
        first = f;
        rest = r;
    }
}
```

构建链表示例：

```java
IntList L = new IntList(5, null);
L.rest = new IntList(10, null);
L.rest.rest = new IntList(15, null);
```

**递归求长度**：

```java
public int size() {
    return (rest == null) ? 1 : 1 + rest.size();
}
```

**迭代求长度**：

```java
public int iterativeSize() {
    IntList p = this;
    int size = 0;
    while (p != null) {
        size++;
        p = p.rest;
    }
    return size;
}
```

**获取元素**：

```java
public int get(int i) {
    if (i == 0) return first;
    return rest.get(i - 1);
}
```

> 注意：该方法时间复杂度为O(N)，后续课程将介绍高效实现方式。