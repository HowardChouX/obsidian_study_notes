# 18.3 Inserting LLRB Trees

---

## 树结构维护

我们始终可以通过向2-3树插入节点后转换的方式维护左倾红黑树。然而这种做法违背了创建左倾红黑树的初衷——避免复杂的2-3树实现！

相反地，**我们将采用与普通二叉搜索树相同的方式插入节点**。为确保树结构与2-3树保持一一对应，我们将使用**旋转操作**来恢复其合法结构。

---

## 结构维护原则

插入操作始终使用**红色链接**连接新节点与父节点。这模拟了2-3树中向叶节点添加元素的特性。

当插入操作破坏左倾红黑树性质时，需通过以下三种情况处理：

### 情况1：右倾"3节点" -> 左倾违规
![](https://cs61b-2.gitbook.io/~gitbook/image?url=https%3A%2F%2F2316889115-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-x-prod.appspot.com%2Fo%2Fspaces%252FCLYj7ccqvV6l4Pt9R0w5%252Fuploads%252FokHHZtbRyLXccIEFaOY4%252FScreen%2520Shot%25202023-02-27%2520at%25208.57.00%2520PM.png%3Falt%3Dmedia%26token%3Dd0499fb0-2fdb-4263-b2b0-6b20c605c26b&width=768&dpr=4&quality=100&sign=238e5438&sv=2)

- **处理方式：左旋(node)**
- 左倾红黑树禁止存在右红链接
- 若左子节点同为红色，可暂时保留（详见情况2）

---

### 情况2：左子树双重插入 -> 非法4节点
![](https://cs61b-2.gitbook.io/~gitbook/image?url=https%3A%2F%2F2316889115-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-x-prod.appspot.com%2Fo%2Fspaces%252FCLYj7ccqvV6l4Pt9R0w5%252Fuploads%252FEnMUNTPORQi12PX7wMqC%252FScreen%2520Shot%25202023-02-27%2520at%25208.58.30%2520PM.png%3Falt%3Dmedia%26token%3D425edbb2-91c0-4321-a738-a71484e30adc&width=768&dpr=4&quality=100&sign=268f4c2d&sv=2)

- **处理方式：右旋(node)**
- 连续两个左红链接形成非法4节点
- 通过旋转转化为情况1结构，最终通过情况3处理

---

### 情况3：双红子节点 -> 临时4节点
![](https://cs61b-2.gitbook.io/~gitbook/image?url=https%3A%2F%2F2316889115-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-x-prod.appspot.com%2Fo%2Fspaces%252FCLYj7ccqvV6l4Pt9R0w5%252Fuploads%252F1ZlL0yP2Mxr4ZBWUEqyY%252FScreen%2520Shot%25202023-02-27%2520at%25209.02.17%2520PM.png%3Falt%3Dmedia%26token%3D544c407f-5a49-43b7-9b4d-dfcd1df71421&width=768&dpr=4&quality=100&sign=6e5ef1e2&sv=2)

- **处理方式：颜色翻转**
- 通过翻转节点颜色模拟2-3树中节点上推操作

---

## 维护操作流程
持续检测树结构，直至满足以下条件：
1. 保持与2-3树的一一对应
2. 不违反左倾红黑树性质

按以下优先级处理违规：
1. 左倾违规 -> 左旋
2. 非法4节点 -> 右旋
3. 临时4节点 -> 颜色翻转

---

## 维护操作摘要

| 违规类型                  | 处理方式     | 对应操作         |
|--------------------------|-------------|------------------|
| 右倾"3节点"（左倾违规）   | 左旋操作     | `rotateLeft()`  |
| 连续左红链接（非法4节点） | 右旋操作     | `rotateRight()` |
| 双红子节点（临时4节点）   | 颜色翻转操作 | `colorFlip()`   |

