#  仓库规则（自主管理）

- **租用**：你需要多大空间自己申请（如`malloc(100)`租100字节）。
- **归还**：用完必须**手动退还钥匙**（`free()`），否则仓库永远被占着（内存泄漏）。
- **自由存取**：可以随时访问任意位置（随机访问，不像栈只能操作顶部）。

---

#  生活中的例子

## 场景1：图书馆借书

- 你借了5本书（申请堆内存），读完必须**主动还书**（释放内存）。
- 如果忘记还书，其他人永远借不到这些书（内存泄漏）。

## 场景2：乐高积木

- 你从大箱子里抓一把积木（堆内存）拼模型，用完要放回箱子。
- 如果随手乱丢，积木越来越少（内存耗尽），最后无法拼新模型（程序崩溃）。

---

# 计算机中的核心用途

- **动态数据**：需要运行时才确定大小的数据（如用户上传的图片、未知长度的数组）。
- **全局访问**：数据可跨函数长期存在（不像栈变量函数结束就消失）。
- **手动管理**：  
    ✅ C/C++：显式调用`malloc`/`free`  
    ✅ Java/Python：垃圾回收器（GC）自动清理，但仍有内存泄漏风险（如未释放监听器）。

---

# 堆的优缺点

|优点|缺点|
|---|---|
|容量大（可用全部内存）|分配/释放速度比栈慢|
|灵活（尺寸可变，长期存）|手动管理易出错（泄漏/野指针）|

---

#  实际代码例子

```c
// 租仓库：申请堆空间存10个整数
int* arr = malloc(10 * sizeof(int)); 

// 使用仓库
arr[0] = 42;  // 直接操作任意位置
arr[9] = 100; 

// 必须还钥匙！
free(arr);  
// 忘记free → 内存泄漏（程序长时间运行会崩溃）
```